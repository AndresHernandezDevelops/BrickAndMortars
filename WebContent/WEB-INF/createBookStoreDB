DROP TABLE address;
DROP TABLE book;
DROP TABLE Login;
DROP TABLE po;
DROP TABLE poitem;
DROP TABLE review;
DROP TABLE visitevent;

/** username: login id
* password: login password
**/
CREATE TABLE Login(
username VARCHAR(30) NOT NULL,
password VARCHAR(30) NOT NULL,
PRIMARY KEY(username)
);
INSERT INTO login (username, password) values 
('****', '*'),
('juyoung', 'admin'),
('andres', 'password'),
('saad', 'rebooted');

/** bid: unique identifier of Book (like ISBN)
* title: title of Book
* price: unit price WHEN ordered
* author: name of authors
* category: as specified
*/
CREATE TABLE Book (
bid VARCHAR(20) NOT NULL,
title VARCHAR(60) NOT NULL,
price INT NOT NULL,
category VARCHAR(32) CONSTRAINT category_ck CHECK (category IN ('Science','Fiction','Engineering'))  NOT NULL,
PRIMARY KEY(bid)
);/*
#
# Adding data for table 'Book'
#*/
INSERT INTO Book (bid, title, price, category) VALUES ('b001', 'Little Prince', 20, 'Fiction');
INSERT INTO Book (bid, title, price, category) VALUES ('b002','Physics', 201, 'Science');
INSERT INTO Book (bid, title, price, category) VALUES ('b003','Mechanics' ,100,'Engineering');

/* Address
* id: address id
*
*/

CREATE TABLE Address (
username varchar(30) NOT NULL,
street VARCHAR(100) NOT NULL,
province VARCHAR(20) NOT NULL,
country VARCHAR(20) NOT NULL,
zip VARCHAR(20) NOT NULL,
phone VARCHAR(20) not NULL,
firstname VARCHAR(30) NOT NULL,
LASTNAME VARCHAR(30) NOT NULL,
PRIMARY KEY(username),
foreign key (username) references login(username) on delete cascade
);
/*
# Inserting data for table 'address'
#*/
INSERT INTO Address (username, street, province, country, zip, phone, firstname, lastname) VALUES ('juyoung', '123 Yonge St', 'ON',
'Canada', 'K1E 6T5' ,'647-123-4567', 'John', 'White');
INSERT INTO Address (username, street, province, country, zip, phone, firstname, lastname) VALUES ('andres','445 Avenue rd', 'ON',
'Canada', 'M1C 6K5' ,'416-123-8569', 'Peter', 'Black');
INSERT INTO Address (username, street, province, country, zip, phone, firstname, lastname) VALUES ('saad', '789 Keele St.', 'ON',
'Canada', 'K3C 9T5' ,'416-123-9568', 'Andy', 'Green');


/* Purchase Order
* lname: last name
* fname: first name
* id: purchase order id
* status:status of purchase
*/
CREATE TABLE PO (
username VARCHAR(30) NOT NULL,
lname VARCHAR(20) NOT NULL,
fname VARCHAR(20) NOT NULL,
status VARCHAR(32) CONSTRAINT status_ck CHECK (status IN ('ORDERED','PROCESSED','DENIED')) NOT NULL,
address INT NOT NULL,
PRIMARY KEY(username),
/*INDEX (address),*/
foreign key (username) references login(username) on delete cascade
);/*
#
# Inserting data for table 'PO'
#*/
INSERT INTO PO (username, lname, fname, status, address) VALUES ('juyoung', 'John', 'White', 'PROCESSED', 1);
INSERT INTO PO (username, lname, fname, status, address) VALUES ('andres', 'Peter', 'Black', 'DENIED', 2);
INSERT INTO PO (username, lname, fname, status, address) VALUES ('saad', 'Andy', 'Green', 'ORDERED', 3);


/* Items on order
* id : purchase order id
* bid: unique identifier of Book
* price: unit price
*/
CREATE TABLE POItem (
username VARCHAR(30) NOT NULL,
bid VARCHAR(20) NOT NULL,
price INT NOT NULL,
PRIMARY KEY(username,bid),
/*INDEX (id),*/
foreign key (username) references login(username) on delete cascade,
/*INDEX (bid),*/
FOREIGN KEY(bid) REFERENCES Book(bid) ON DELETE CASCADE
);
/*
# Inserting data for table 'POitem'
*/
INSERT INTO POItem (username, bid, price) VALUES ('juyoung', 'b001', 20);
INSERT INTO POItem (username, bid, price) VALUES ('andres', 'b002', 201);
INSERT INTO POItem (username, bid, price) VALUES ('saad', 'b003', 100);


/* visit to website
* day: date
* bid: unique identifier of Book
* eventtype: status of purchase
*/
CREATE TABLE VisitEvent (
day varchar(8) NOT NULL,
bid varchar(20) not null, /*REFERENCES Book.bid,*/
eventtype VARCHAR(32) CONSTRAINT eventtype_ck CHECK (eventtype IN ('VIEW','CART','PURCHASE')) NOT NULL,
FOREIGN KEY(bid) REFERENCES Book(bid)
);

/*Dumping data for table 'VisitEvent'*/

INSERT INTO VisitEvent (day, bid, eventtype) VALUES ('12202015', 'b001', 'VIEW');
INSERT INTO VisitEvent (day, bid, eventtype) VALUES ('12242015', 'b001', 'CART');
INSERT INTO VisitEvent (day, bid, eventtype) VALUES ('12252015', 'b001', 'PURCHASE');


update visitevent set day = '20150120' where day = '20180103';
update visitevent set day = '20151220' where day = '20170429';
update visitevent set day = '20151221' where day = '20180426';
update visitevent set day = '20151222' where day = '20180425';
update visitevent set day = '20151225' where day = '20180424';

CREATE TABLE REVIEW (
bid VARCHAR(20) NOT NULL,
name VARCHAR(20) NOT NULL,
day varchar(20) NOT NULL,
review varchar(200),
rating int,
PRIMARY KEY(bid, name, day),
FOREIGN KEY (bid) REFERENCES book (bid) ON DELETE CASCADE
);

insert into review(bid, name, day, review, rating) values ('b001', 'joseph', '20180420162530', 'this book sucks!!!!! somebody save me!!', 5);
insert into review(bid, name, day, review, rating) values ('b001', 'anonymous', '20180421183034', 'this book aint that bad, but ill still give it a 1', 1);
insert into review(bid, name, day, review, rating) values ('b002', 'henry', '20180415104445', 'meh ive written better books', 3);
